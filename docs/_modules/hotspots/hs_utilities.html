
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hotspots.hs_utilities &#8212; Hotspots API 1.0.2 documentation</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Hotspots API 1.0.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hotspots.hs_utilities</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hotspots.hs_utilities</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The :mod:`hotspots.utilities` module contains classes to for</span>
<span class="sd">general functionality.</span>

<span class="sd">The main classes of the :mod:`hotspots.extraction` module are:</span>
<span class="sd">    - :class:`hotspots.hs_utilities.Helper`</span>
<span class="sd">    - :class:`hotspots.hs_utilities.Figures`</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">mkdir</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">exists</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">abspath</span>

<span class="c1"># import matplotlib as mpl</span>
<span class="c1"># mpl.use(&#39;TkAgg&#39;)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">ccdc.cavity</span> <span class="kn">import</span> <span class="n">Cavity</span>
<span class="kn">from</span> <span class="nn">ccdc.io</span> <span class="kn">import</span> <span class="n">MoleculeWriter</span>
<span class="kn">from</span> <span class="nn">ccdc.molecule</span> <span class="kn">import</span> <span class="n">Molecule</span><span class="p">,</span> <span class="n">Atom</span>


<span class="n">Coordinates</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">_generate_usr_moment</span><span class="p">(</span><span class="n">fcoords_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PRIVATE EXPERIMENTAL FEATURE</span>

<span class="sd">    Modification of Adrian Schreyer&#39;s code https://bitbucket.org/aschreyer/usrcat</span>

<span class="sd">    More information on the USR algorithm:</span>
<span class="sd">        - https://doi.org/10.1098/rspa.2007.1823</span>

<span class="sd">    :param grds:</span>

<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">usrcat.geometry</span> <span class="kn">import</span> <span class="n">usr_moments</span><span class="p">,</span> <span class="n">usr_moments_with_existing</span>

    <span class="n">all_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fcoords_list</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
    <span class="c1">#np.vstack(fcoords_list)</span>
    <span class="p">(</span><span class="n">ctd</span><span class="p">,</span> <span class="n">cst</span><span class="p">,</span> <span class="n">fct</span><span class="p">,</span> <span class="n">ftf</span><span class="p">),</span> <span class="n">om</span> <span class="o">=</span> <span class="n">usr_moments</span><span class="p">(</span><span class="n">all_coords</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">fcoords</span> <span class="ow">in</span> <span class="n">fcoords_list</span><span class="p">:</span>

        <span class="c1"># initial zeroed out USRCAT feature moments</span>
        <span class="n">fm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

        <span class="c1"># only attempt to generate moments if there are enough atoms available!</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fcoords</span><span class="p">):</span>
            <span class="n">fm</span> <span class="o">=</span> <span class="n">usr_moments_with_existing</span><span class="p">(</span><span class="n">fcoords</span><span class="p">,</span> <span class="n">ctd</span><span class="p">,</span> <span class="n">cst</span><span class="p">,</span> <span class="n">fct</span><span class="p">,</span> <span class="n">ftf</span><span class="p">)</span>

        <span class="c1"># append feature moments to the existing ones</span>
        <span class="n">om</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">om</span><span class="p">,</span> <span class="n">fm</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">om</span><span class="p">])</span>



<div class="viewcode-block" id="Helper"><a class="viewcode-back" href="../../hs_utilities_api.html#hotspots.hs_utilities.Helper">[docs]</a><span class="k">class</span> <span class="nc">Helper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to handle miscellaneous functionality</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Helper.get_distance"><a class="viewcode-back" href="../../hs_utilities_api.html#hotspots.hs_utilities.Helper.get_distance">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_distance</span><span class="p">(</span><span class="n">coords1</span><span class="p">,</span> <span class="n">coords2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        given two coordinates, calculates the distance</span>

<span class="sd">        :param tup coords1: float(x), float(y), float(z), coordinates of point 1</span>
<span class="sd">        :param tup coords2: float(x), float(y), float(z), coordinates of point 2</span>
<span class="sd">        :return: float, distance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xd</span> <span class="o">=</span> <span class="n">coords1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yd</span> <span class="o">=</span> <span class="n">coords1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">zd</span> <span class="o">=</span> <span class="n">coords1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xd</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">yd</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">zd</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="Helper.get_out_dir"><a class="viewcode-back" href="../../hs_utilities_api.html#hotspots.hs_utilities.Helper.get_out_dir">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_out_dir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks if directory exists, if not, it create the directory</span>

<span class="sd">        :param str path: path to directory</span>
<span class="sd">        :return str: path to output directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
            <span class="n">mkdir</span><span class="p">(</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="Helper.get_lines_from_file"><a class="viewcode-back" href="../../hs_utilities_api.html#hotspots.hs_utilities.Helper.get_lines_from_file">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_lines_from_file</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets lines from text file, used in Ghecom calculation</span>

<span class="sd">        :return: list, list of str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
            <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">lines</span></div>

<div class="viewcode-block" id="Helper.cavity_centroid"><a class="viewcode-back" href="../../hs_utilities_api.html#hotspots.hs_utilities.Helper.cavity_centroid">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">cavity_centroid</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the centre of a cavity</span>

<span class="sd">        :param obj: can be a `ccdc.cavity.Cavity` or</span>
<span class="sd">        :return: Coordinate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Cavity</span><span class="p">):</span>
            <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">coordinates</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">features</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">surface_points</span>

        <span class="n">x_avg</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">feat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">float</span><span class="p">)]))</span>
        <span class="n">y_avg</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">feat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">float</span><span class="p">)]))</span>
        <span class="n">z_avg</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">feat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">float</span><span class="p">)]))</span>

        <span class="k">return</span> <span class="n">Coordinates</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_avg</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_avg</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z_avg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Helper.cavity_from_protein"><a class="viewcode-back" href="../../hs_utilities_api.html#hotspots.hs_utilities.Helper.cavity_from_protein">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">cavity_from_protein</span><span class="p">(</span><span class="n">prot</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        currently the Protein API doesn&#39;t support the generation of cavities directly from the Protein instance</span>
<span class="sd">        this method handles the tedious writing / reading</span>

<span class="sd">        :param `ccdc.protein.Protein` prot: protein</span>
<span class="sd">        :return: `ccdc.cavity.Cavity`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tfile</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(),</span> <span class="s2">&quot;protein.pdb&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">MoleculeWriter</span><span class="p">(</span><span class="n">tfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prot</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Cavity</span><span class="o">.</span><span class="n">from_pdb_file</span><span class="p">(</span><span class="n">tfile</span><span class="p">)</span></div>

<div class="viewcode-block" id="Helper.get_label"><a class="viewcode-back" href="../../hs_utilities_api.html#hotspots.hs_utilities.Helper.get_label">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_label</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        creates a value labels from an input grid dictionary</span>

<span class="sd">        :param dic input: key = &quot;probe identifier&quot; and value = `ccdc.utilities.Grid`</span>
<span class="sd">        :return `ccdc.molecule.Molecule`: pseduomolecule which contains score labels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">min_size_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;apolar&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
                         <span class="s2">&quot;donor&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                         <span class="s2">&quot;acceptor&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
                         <span class="s2">&quot;negative&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
                         <span class="s2">&quot;positive&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}</span>

        <span class="n">atom_dic</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;apolar&quot;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;aromatic&quot;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;donor&quot;</span><span class="p">:</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;weak_donor&quot;</span><span class="p">:</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;acceptor&quot;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;weak_acceptor&quot;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;negative&quot;</span><span class="p">:</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;positve&quot;</span><span class="p">:</span> <span class="s1">&#39;H&#39;</span>
                    <span class="c1">#&quot;surface&quot;: &#39;&#39;</span>
                    <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">interaction_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom_dic</span><span class="p">[</span><span class="n">feat</span><span class="o">.</span><span class="n">feature_type</span><span class="p">]</span> <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">_features</span> <span class="k">if</span> <span class="n">feat</span><span class="o">.</span><span class="n">feature_type</span> <span class="o">!=</span> <span class="s2">&quot;surface&quot;</span><span class="p">]</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="n">feat</span><span class="o">.</span><span class="n">feature_coordinates</span> <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">_features</span> <span class="k">if</span> <span class="n">feat</span><span class="o">.</span><span class="n">feature_type</span> <span class="o">!=</span> <span class="s2">&quot;surface&quot;</span><span class="p">]</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">feat</span><span class="o">.</span><span class="n">score_value</span> <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">_features</span> <span class="k">if</span> <span class="n">feat</span><span class="o">.</span><span class="n">feature_type</span> <span class="o">!=</span> <span class="s2">&quot;surface&quot;</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">interaction_types</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">island</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">islands</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">island</span><span class="o">.</span><span class="n">count_grid</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">min_size_dict</span><span class="p">[</span><span class="n">p</span><span class="p">]:</span>
                                <span class="n">interaction_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom_dic</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
                                <span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">island</span><span class="o">.</span><span class="n">centroid</span><span class="p">())</span>
                                <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">island</span><span class="o">.</span><span class="n">grid_values</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)))</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;object not supported&quot;</span><span class="p">)</span>

        <span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="s2">&quot;pharmacophore_model&quot;</span><span class="p">)</span>

        <span class="n">pseudo_atms</span> <span class="o">=</span> <span class="p">[</span><span class="n">Atom</span><span class="p">(</span><span class="n">atomic_symbol</span><span class="o">=</span><span class="n">interaction_types</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                            <span class="n">atomic_number</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
                            <span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                            <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">interaction_types</span><span class="p">))]</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">pseudo_atms</span><span class="p">:</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mol</span></div>

<div class="viewcode-block" id="Helper.get_atom_type"><a class="viewcode-back" href="../../hs_utilities_api.html#hotspots.hs_utilities.Helper.get_atom_type">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_atom_type</span><span class="p">(</span><span class="n">atom</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the atom classification</span>

<span class="sd">        :param atom:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">is_donor</span> <span class="ow">and</span> \
                <span class="n">atom</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span> <span class="ow">and</span> \
                <span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">neighbours</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">atomic_symbol</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;donor&quot;</span>
        <span class="k">elif</span> <span class="n">atom</span><span class="o">.</span><span class="n">is_donor</span> <span class="ow">and</span> <span class="n">atom</span><span class="o">.</span><span class="n">is_acceptor</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;doneptor&quot;</span>
        <span class="k">elif</span> <span class="n">atom</span><span class="o">.</span><span class="n">is_acceptor</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;acceptor&quot;</span>
        <span class="k">elif</span> <span class="n">atom</span><span class="o">.</span><span class="n">is_donor</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;donor&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;apolar&quot;</span></div></div>


<div class="viewcode-block" id="Figures"><a class="viewcode-back" href="../../hs_utilities_api.html#hotspots.hs_utilities.Figures">[docs]</a><span class="k">class</span> <span class="nc">Figures</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to handle the generation of hotspot related figures</span>

<span class="sd">    TO DO: is there a better place for this to live?</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Figures.histogram"><a class="viewcode-back" href="../../hs_utilities_api.html#hotspots.hs_utilities.Figures.histogram">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">histogram</span><span class="p">(</span><span class="n">hr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        creates a histogram from the hotspot scores</span>

<span class="sd">        :param `hotspots.result.Results` hr: a Fragment Hotspot Map result</span>
<span class="sd">        :return: data, plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">hr</span><span class="o">.</span><span class="n">super_grids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_array</span><span class="p">()</span>
            <span class="n">masked_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less_equal</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">grid_values</span> <span class="o">=</span> <span class="n">masked_array</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
            <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">p</span><span class="p">:</span> <span class="n">grid_values</span><span class="p">})</span>

        <span class="n">plt</span> <span class="o">=</span> <span class="n">Figures</span><span class="o">.</span><span class="n">_plot_histogram</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">plt</span></div>


    <span class="c1"># @staticmethod</span>
    <span class="c1"># def _2D_diagram(hr, ligand, fpath, title):</span>
    <span class="c1">#     &#39;&#39;&#39;</span>
    <span class="c1">#     Display the distribution of scores as a heatmap on a 2D depiction of the molecule</span>
    <span class="c1">#</span>
    <span class="c1">#     :param ligand: a :class:`ccdc.Molecule` object.</span>
    <span class="c1">#     :param title: str, Title placed at the top of the image</span>
    <span class="c1">#     :param output: str, Output file name</span>
    <span class="c1">#     :return:</span>
    <span class="c1">#     &#39;&#39;&#39;</span>
    <span class="c1"># try:</span>
    <span class="c1">#     from rdkit import Chem</span>
    <span class="c1">#     from rdkit.Chem import Draw</span>
    <span class="c1">#     from rdkit.Chem import AllChem</span>
    <span class="c1">#     from matplotlib.colors import LinearSegmentedColormap</span>
    <span class="c1"># except ImportError:</span>
    <span class="c1">#     print(&quot;&quot;&quot;rdkit is needed for this method&quot;&quot;&quot;)</span>
    <span class="c1">#     exit()</span>
    <span class="c1">#</span>
    <span class="c1">#     mol = MoleculeReader(ligand)[0]</span>
    <span class="c1">#</span>
    <span class="c1">#     if ligand.split(&quot;.&quot;)[-1] == &quot;mol2&quot;:</span>
    <span class="c1">#         with open(ligand, &#39;r&#39;) as lig:</span>
    <span class="c1">#             data = lig.read()</span>
    <span class="c1">#         mol_rdkit = Chem.MolFromMol2Block(data)</span>
    <span class="c1">#         AllChem.Compute2DCoords(mol_rdkit)</span>
    <span class="c1">#</span>
    <span class="c1">#     elif ligand.split(&quot;.&quot;)[-1] == &quot;sdf&quot;:</span>
    <span class="c1">#         suppl = Chem.SDMolSupplier(ligand)</span>
    <span class="c1">#         mol_rdkit = suppl[0]</span>
    <span class="c1">#         AllChem.Compute2DCoords(mol_rdkit)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         print(&quot;Method supports .mol2 files only!&quot;)</span>
    <span class="c1">#         raise ValueError</span>
    <span class="c1">#</span>
    <span class="c1">#     scores = hr.score_ligand_atoms(mol, schematic=True, tolerance=2)</span>
    <span class="c1">#     num_atoms = mol_rdkit.GetNumAtoms()</span>
    <span class="c1">#     a = 0.9 / (float(num_atoms))</span>
    <span class="c1">#     s = 0.005</span>
    <span class="c1">#</span>
    <span class="c1">#     contribs = [float(scores[mol_rdkit.GetAtomWithIdx(i).GetProp(&#39;_TriposAtomName&#39;)]) for i in</span>
    <span class="c1">#                 range(mol_rdkit.GetNumAtoms())]</span>
    <span class="c1">#</span>
    <span class="c1">#     fig = Draw.MolToMPL(mol_rdkit)</span>
    <span class="c1">#</span>
    <span class="c1">#     cm = colourmap(scheme=&quot;inferno&quot;)</span>
    <span class="c1">#     test_cm = LinearSegmentedColormap.from_list(__file__, cm)</span>
    <span class="c1">#     try:</span>
    <span class="c1">#         x, y, z = Draw.calcAtomGaussians(mol_rdkit, a, step=s, weights=contribs)</span>
    <span class="c1">#</span>
    <span class="c1">#         fig.axes[0].imshow(z, cmap=test_cm, interpolation=&#39;bilinear&#39;, origin=&#39;lower&#39;, alpha=0.9,</span>
    <span class="c1">#                            extent=(0, 1, 0, 1))</span>
    <span class="c1">#         fig.axes[0].contour(x, y, z, 5, colors=&#39;k&#39;, alpha=0.2)</span>
    <span class="c1">#     except ValueError:</span>
    <span class="c1">#         print(&quot;&quot;)</span>
    <span class="c1">#</span>
    <span class="c1">#     if title:</span>
    <span class="c1">#         fig.text(1.25, 2.3, title, fontsize=20, horizontalalignment=&#39;center&#39;, verticalalignment=&#39;top&#39;,</span>
    <span class="c1">#                  color=&quot;white&quot;)</span>
    <span class="c1">#</span>
    <span class="c1">#     fig.savefig(output, bbox_inches=&#39;tight&#39;)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_plot_histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Fragment Hotspot Maps&quot;</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            initialise the matplotlib figure to output histograms</span>

<span class="sd">            :param data:</span>
<span class="sd">            :return:</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">colour_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;acceptor&quot;</span><span class="p">:</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;donor&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;apolar&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;negative&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;positive&quot;</span><span class="p">:</span> <span class="s2">&quot;c&quot;</span><span class="p">}</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">hist</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">Figures</span><span class="o">.</span><span class="n">_histogram_settings</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fragment hotspot score&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">j</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colour_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">plt</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_histogram_settings</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        display settings</span>
<span class="sd">        :param bin_edges:</span>
<span class="sd">        :param title:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>

    <span class="k">def</span> <span class="nf">_histogram_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        data for the matplotlib figure</span>

<span class="sd">        :param data:</span>
<span class="sd">        :param key:</span>
<span class="sd">        :param n:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">colour_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;acceptor&quot;</span><span class="p">:</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;donor&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;apolar&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">}</span>
        <span class="n">hist</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colour_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Fragment-hotspot Maps&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fragment hotspot score&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Hotspots API 1.0.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">hotspots.hs_utilities</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright Chris Radoux, Peter Curran, Mihaela D. Smilova, Richard A. Sykes, Alicia Higueruelo, Anthony Bradley, Brian D. Marsdend, David R. Spring, Tom L. Blundell, Andrew R. Leach, William R. Pitt, Jason C. Cole.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>