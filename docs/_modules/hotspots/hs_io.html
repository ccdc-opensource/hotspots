

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>hotspots.hs_io &mdash; Hotspots API 1.0.2 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Hotspots API
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#installation-notes">Installation Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html#cookbook-documentation">Cookbook Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../calculation_api.html">Hotspot Calculation API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hs_io_api.html">Hotspot IO API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../result_api.html">Result API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hs_pharmacophore_api.html">Hotspot Pharmacophore API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hs_docking_api.html">Hotspot Docking API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hs_utilities_api.html">Hotspot Utilities API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Hotspots API</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>hotspots.hs_io</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for hotspots.hs_io</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The :mod:`hotspots.hs_io` module was created to facilitate easy reading and</span>
<span class="sd">writing of Fragment Hotspot Map results.</span>

<span class="sd">There are multiple components to a :class:`hotspots.result.Result` including, the</span>
<span class="sd">protein, interaction grids and buriedness grid. It is therefore tedious to manually</span>
<span class="sd">read/write using the various class readers/writers. The Hotspots I/O organises this</span>
<span class="sd">for the user and can handle single :class:`hotspots.result.Result` or lists of</span>
<span class="sd">:class:`hotspots.result.Result`.</span>


<span class="sd">The main classes of the :mod:`hotspots.io` module are:</span>

<span class="sd">- :class:`hotspots.io.HotspotWriter`</span>
<span class="sd">- :class:`hotspots.io.HotspotReader`</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span><span class="p">,</span> <span class="n">walk</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">splitext</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">isdir</span><span class="p">,</span> <span class="n">isfile</span>

<span class="kn">from</span> <span class="nn">ccdc</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">from</span> <span class="nn">ccdc.protein</span> <span class="kn">import</span> <span class="n">Protein</span>
<span class="kn">from</span> <span class="nn">ccdc.utilities</span> <span class="kn">import</span> <span class="n">PushDir</span>
<span class="kn">from</span> <span class="nn">ccdc.molecule</span> <span class="kn">import</span> <span class="n">Molecule</span><span class="p">,</span> <span class="n">Atom</span>
<span class="kn">from</span> <span class="nn">hotspots.grid_extension</span> <span class="kn">import</span> <span class="n">Grid</span>
<span class="kn">from</span> <span class="nn">hotspots.result</span> <span class="kn">import</span> <span class="n">Results</span>
<span class="kn">from</span> <span class="nn">hotspots.hs_utilities</span> <span class="kn">import</span> <span class="n">Helper</span>
<span class="kn">from</span> <span class="nn">hotspots.wrapper_pymol</span> <span class="kn">import</span> <span class="n">PyMOLCommands</span><span class="p">,</span> <span class="n">PyMOLFile</span>


<div class="viewcode-block" id="HotspotWriter"><a class="viewcode-back" href="../../hs_io_api.html#hotspots.hs_io.HotspotWriter">[docs]</a><span class="k">class</span> <span class="nc">HotspotWriter</span><span class="p">(</span><span class="n">Helper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to handle the writing of a :class`hotspots.result.Result`. Additionally, creation of the</span>
<span class="sd">    PyMol visualisation scripts are handled here.</span>

<span class="sd">    :param str path: path to output directory</span>
<span class="sd">    :param str visualisation: &quot;pymol&quot; or &quot;ngl&quot; currently only PyMOL available</span>
<span class="sd">    :param str grid_extension: &quot;.grd&quot;, &quot;.ccp4&quot; and &quot;.acnt&quot; supported</span>
<span class="sd">    :param bool zip_results: If True, the result directory will be compressed. (recommended)</span>
<span class="sd">    :param `hotspots.hs_io.HotspotWriter.Settings` settings: settings</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HotspotWriter.Settings"><a class="viewcode-back" href="../../hs_io_api.html#hotspots.hs_io.HotspotWriter.Settings">[docs]</a>    <span class="k">class</span> <span class="nc">Settings</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A class to hold the :class:`hotspots.hs_io.HotspotWriter` settings</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_superstar</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_weighted</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_buriedness</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_extension</span> <span class="o">=</span> <span class="s2">&quot;.grd&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bg_color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">surface_trim_factor</span> <span class="o">=</span> <span class="mi">13</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">organic_sticks</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isosurface_threshold</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grids</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transparency</span> <span class="o">=</span> <span class="mf">0.2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_labels</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">supported_grids</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.grd&quot;</span><span class="p">,</span> <span class="s2">&quot;.ccp4&quot;</span><span class="p">,</span> <span class="s2">&quot;.acnt&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pharmacophore</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pharmacophore_labels</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pharmacophore_format</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.py&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;out&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">identifier_tag</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># e.g. self.protein_color_dic = {f&quot;protein_{hr.identifier}&quot;: &quot;slate&quot;}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">protein_color_dic</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colour_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;acceptor&#39;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;donor&#39;</span><span class="p">:</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;apolar&#39;</span><span class="p">:</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;negative&#39;</span><span class="p">:</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;positive&#39;</span><span class="p">:</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;buriedness&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">}</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">grid_extension</span><span class="o">=</span><span class="s2">&quot;.grd&quot;</span><span class="p">,</span> <span class="n">zip_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">settings</span>

        <span class="k">if</span> <span class="n">grid_extension</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">supported_grids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">grid_extension</span> <span class="o">=</span> <span class="n">grid_extension</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">grid_extension</span> <span class="o">=</span> <span class="s2">&quot;.grd&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: Invalid grid file format provided. Default: &#39;.grd&#39; will be used&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_out_dir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">zip_results</span> <span class="o">=</span> <span class="n">zip_results</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span> <span class="o">=</span> <span class="n">PyMOLFile</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_results</span><span class="p">:</span>
            <span class="c1"># unzip and change working directory</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">unzip_dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">container</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">traceback</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="p">)</span>

<div class="viewcode-block" id="HotspotWriter.write"><a class="viewcode-back" href="../../hs_io_api.html#hotspots.hs_io.HotspotWriter.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        writes the Fragment Hotspot Maps result to the output directory and create the pymol visualisation file</span>

<span class="sd">        :param hr: a Fragment Hotspot Maps result or list of results</span>
<span class="sd">        :type hr: `hotspots.result.Result`</span>

<span class="sd">        &gt;&gt;&gt; from hotspots.calculation import Runner</span>
<span class="sd">        &gt;&gt;&gt; from hotspots.hs_io import HotspotWriter</span>

<span class="sd">        &gt;&gt;&gt; r = Runner</span>
<span class="sd">        &gt;&gt;&gt; result = r.from_pdb(&quot;1hcl&quot;)</span>
<span class="sd">        &gt;&gt;&gt; out_dir = &lt;path_to_out&gt;</span>
<span class="sd">        &gt;&gt;&gt; with HotspotWriter(out_dir) as w:</span>
<span class="sd">        &gt;&gt;&gt;     w.write(result)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">container</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">get_out_dir</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">container</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hr</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">hr</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">({</span><span class="n">h</span><span class="o">.</span><span class="n">identifier</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hr</span><span class="p">})</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hr</span><span class="p">):</span>
                <span class="c1"># if there are not unique identifiers, create some.</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hr</span><span class="p">):</span>
                    <span class="n">h</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;hotspot-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_single_write</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="p">:</span>
                <span class="n">hr</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="s2">&quot;hotspot&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_single_write</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">hr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pymol_isoslider</span><span class="p">(</span><span class="n">hr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">background_color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">bg_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">push_to_wd</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_results</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compress</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;pymol_file.py&quot;</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_single_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">hr</span><span class="p">):</span>
        <span class="n">hr</span><span class="o">.</span><span class="n">out_dir</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">get_out_dir</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_grids</span><span class="p">(</span><span class="n">hr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_protein</span><span class="p">(</span><span class="n">hr</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">hr</span><span class="o">.</span><span class="n">protein</span><span class="p">)</span>

        <span class="n">relpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pymol_objects</span><span class="p">(</span><span class="n">relpath</span><span class="p">,</span> <span class="n">hr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_grids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write probe grids to output directory</span>

<span class="sd">        :param grid_dict: hotspot result grid dict</span>
<span class="sd">        :param buriedness: buriedness grid</span>

<span class="sd">        :type grid_dict: hotspot.grid_extension.Grid</span>
<span class="sd">        :type buriedness: hotspot.grid_extension.Grid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">hr</span><span class="o">.</span><span class="n">super_grids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">hr</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">grid_extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">output_buriedness</span> <span class="ow">and</span> <span class="n">hr</span><span class="o">.</span><span class="n">buriedness</span><span class="p">:</span>
            <span class="n">hr</span><span class="o">.</span><span class="n">buriedness</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">hr</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;buriedness</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">grid_extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">output_superstar</span> <span class="ow">and</span> <span class="n">hr</span><span class="o">.</span><span class="n">superstar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">hr</span><span class="o">.</span><span class="n">superstar</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">g</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">hr</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;superstar_</span><span class="si">{</span><span class="n">p</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">grid_extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">output_weighted</span> <span class="ow">and</span> <span class="n">hr</span><span class="o">.</span><span class="n">weighted_superstar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">hr</span><span class="o">.</span><span class="n">weighted_superstar</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">g</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">hr</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;weighted_</span><span class="si">{</span><span class="n">p</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">grid_extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_write_protein</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">prot</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        writes protein to output directory</span>

<span class="sd">        :param prot: a protein</span>
<span class="sd">        :type prot: `ccdc.protein.Protein`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">MoleculeWriter</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;protein.pdb&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prot</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_pymol_isoslider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generates the commands for an isoslider</span>

<span class="sd">        :param hr: a hotspot result</span>
<span class="sd">        :type hr: `hotspots.results.Results`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Isosurface obj&#39;s take the name: &quot;surface_{probe ID}_{hotpsot ID}&quot;</span>
        <span class="c1"># e.g. &quot;surface_apolar_hotspotA&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hr</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">hr</span> <span class="o">=</span> <span class="p">[</span><span class="n">hr</span><span class="p">]</span>

        <span class="c1"># the hotspot grids are always output</span>
        <span class="n">surface_dic</span> <span class="o">=</span> <span class="p">{</span><span class="n">h</span><span class="o">.</span><span class="n">identifier</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;fhm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;surface_</span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">h</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">super_grids</span><span class="o">.</span><span class="n">keys</span><span class="p">()]}</span>
                       <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hr</span><span class="p">}</span>

        <span class="n">surface_value_dic</span> <span class="o">=</span> <span class="p">{</span><span class="n">h</span><span class="o">.</span><span class="n">identifier</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;fhm&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">extrema</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">super_grids</span><span class="o">.</span><span class="n">values</span><span class="p">()])}</span>
                             <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hr</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hr</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">output_superstar</span> <span class="ow">and</span> <span class="n">h</span><span class="o">.</span><span class="n">superstar</span><span class="p">:</span>
                <span class="n">surface_dic</span><span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;superstar&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;surface_superstar_</span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">h</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&quot;</span>
                                                                <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">superstar</span><span class="o">.</span><span class="n">keys</span><span class="p">()]})</span>

                <span class="n">surface_value_dic</span><span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;superstar&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">extrema</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
                                                                          <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">superstar</span><span class="o">.</span><span class="n">values</span><span class="p">()])})</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">output_weighted</span> <span class="ow">and</span> <span class="n">h</span><span class="o">.</span><span class="n">weighted_superstar</span><span class="p">:</span>
                <span class="n">surface_dic</span><span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;weighted&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;surface_weighted_superstar_</span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">h</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&quot;</span>
                                                                <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">weighted_superstar</span><span class="o">.</span><span class="n">keys</span><span class="p">()]})</span>

                <span class="n">surface_value_dic</span><span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;weighted&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">extrema</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
                                                                          <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">weighted_superstar</span><span class="o">.</span><span class="n">values</span><span class="p">()])})</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">output_buriedness</span> <span class="ow">and</span> <span class="n">h</span><span class="o">.</span><span class="n">buriedness</span><span class="p">:</span>
                <span class="n">surface_dic</span><span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;buriedness&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;surface_buriedness_</span><span class="si">{</span><span class="n">h</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]})</span>

                <span class="n">surface_value_dic</span><span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;buriedness&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>

        <span class="n">min_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">surface_dic</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">surface_value_dic</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">isoslider</span><span class="p">(</span><span class="n">surface_dic</span><span class="p">,</span> <span class="n">surface_value_dic</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_pymol_isosurfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">relpath</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">dict_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads grids and generates isosurfaces</span>

<span class="sd">        :param dict: interaction grid dictionary</span>
<span class="sd">        :param relpath: result containing directory</span>
<span class="sd">        :param identifier: hotspot identifier</span>
<span class="sd">        :param dict_type: superstar, fhm or weighted_superstar</span>

<span class="sd">        :type dict: dict</span>
<span class="sd">        :type relpath: str</span>
<span class="sd">        :type identifier: str</span>
<span class="sd">        :type dict_type: str</span>

<span class="sd">        :return: pymol commands</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">default_level</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="c1"># load grids and create isosurfaces</span>
        <span class="n">group_members</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">dict_type</span> <span class="o">==</span> <span class="s1">&#39;fhm&#39;</span><span class="p">:</span>
                <span class="n">objname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">relpath</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">p</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">grid_extension</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">objname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dict_type</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">relpath</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">dict_type</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">p</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">grid_extension</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span> <span class="n">objname</span><span class="o">=</span><span class="n">objname</span><span class="p">)</span>

            <span class="c1"># surface_10_apolar_hotspotid</span>
            <span class="n">surface_objname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;surface_</span><span class="si">{</span><span class="n">objname</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">isosurface</span><span class="p">(</span><span class="n">grd_name</span><span class="o">=</span><span class="n">objname</span><span class="p">,</span>
                                            <span class="n">isosurface_name</span><span class="o">=</span><span class="n">surface_objname</span><span class="p">,</span>
                                            <span class="n">level</span><span class="o">=</span><span class="n">default_level</span><span class="p">,</span>
                                            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">colour_dict</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>

            <span class="n">cmd</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">pymol_set</span><span class="p">(</span><span class="n">setting_name</span><span class="o">=</span><span class="s1">&#39;transparency&#39;</span><span class="p">,</span>
                                           <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">transparency</span><span class="p">,</span>
                                           <span class="n">selection</span><span class="o">=</span><span class="n">surface_objname</span><span class="p">)</span>

            <span class="n">group_members</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">objname</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;surface_</span><span class="si">{</span><span class="n">objname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>

        <span class="n">cmd</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">group_name</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span> <span class="n">members</span><span class="o">=</span><span class="n">group_members</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cmd</span>

    <span class="k">def</span> <span class="nf">_write_pymol_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relpath</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">load_prot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generates pymol commands associated with an indivdual hotspot</span>

<span class="sd">        :param relpath: path to the directory holding associated files</span>
<span class="sd">        :param hr: hotspot result</span>

<span class="sd">        :type relpath: str</span>
<span class="sd">        :type hr: `hotspots.results.Results`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_pymol_isosurfaces</span><span class="p">(</span><span class="n">hr</span><span class="o">.</span><span class="n">super_grids</span><span class="p">,</span> <span class="n">relpath</span><span class="p">,</span> <span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="s2">&quot;fhm&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">output_superstar</span> <span class="ow">and</span> <span class="n">hr</span><span class="o">.</span><span class="n">superstar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_pymol_isosurfaces</span><span class="p">(</span><span class="n">hr</span><span class="o">.</span><span class="n">superstar</span><span class="p">,</span> <span class="n">relpath</span><span class="p">,</span> <span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="s2">&quot;superstar&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">output_weighted</span> <span class="ow">and</span> <span class="n">hr</span><span class="o">.</span><span class="n">weighted_superstar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_pymol_isosurfaces</span><span class="p">(</span><span class="n">hr</span><span class="o">.</span><span class="n">weighted_superstar</span><span class="p">,</span> <span class="n">relpath</span><span class="p">,</span> <span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="s2">&quot;weighted&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">output_buriedness</span> <span class="ow">and</span> <span class="n">hr</span><span class="o">.</span><span class="n">buriedness</span><span class="p">:</span>
            <span class="n">default_level</span><span class="o">=</span><span class="mi">3</span>
            <span class="n">objname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;buriedness_</span><span class="si">{</span><span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">relpath</span><span class="si">}</span><span class="s1">/buriedness</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">grid_extension</span><span class="si">}</span><span class="s1">&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span> <span class="n">objname</span><span class="o">=</span><span class="n">objname</span><span class="p">)</span>

            <span class="c1"># surface_10_apolar_hotspotid</span>
            <span class="n">surface_objname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;surface_</span><span class="si">{</span><span class="n">objname</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">isosurface</span><span class="p">(</span><span class="n">grd_name</span><span class="o">=</span><span class="n">objname</span><span class="p">,</span>
                                                       <span class="n">isosurface_name</span><span class="o">=</span><span class="n">surface_objname</span><span class="p">,</span>
                                                       <span class="n">level</span><span class="o">=</span><span class="n">default_level</span><span class="p">,</span>
                                                       <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">colour_dict</span><span class="p">[</span><span class="s2">&quot;buriedness&quot;</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">pymol_set</span><span class="p">(</span><span class="n">setting_name</span><span class="o">=</span><span class="s1">&#39;transparency&#39;</span><span class="p">,</span>
                                                      <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">transparency</span><span class="p">,</span>
                                                      <span class="n">selection</span><span class="o">=</span><span class="n">surface_objname</span><span class="p">)</span>

        <span class="n">group_members</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;buriedness_</span><span class="si">{</span><span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;surface_buriedness_</span><span class="si">{</span><span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">group_name</span><span class="o">=</span><span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="n">members</span><span class="o">=</span><span class="n">group_members</span><span class="p">)</span>

        <span class="c1"># generate grid labels</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">hr</span><span class="o">.</span><span class="n">grid_labels</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">dic</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">group_me</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">coord</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">objname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;PS_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">group_me</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">objname</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">pseudoatom</span><span class="p">(</span><span class="n">objname</span><span class="o">=</span><span class="n">objname</span><span class="p">,</span>
                                                                    <span class="n">coords</span><span class="o">=</span><span class="n">coord</span><span class="p">,</span>
                                                                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">group_me</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">objname</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;label_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">group_me</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;labels_</span><span class="si">{</span><span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;label_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1">&#39;</span>
                                                                  <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hr</span><span class="o">.</span><span class="n">super_grids</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>

        <span class="c1"># load up the protein</span>
        <span class="k">if</span> <span class="n">load_prot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">relpath</span><span class="si">}</span><span class="s1">/protein.pdb&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;protein_</span><span class="si">{</span><span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">protein_color_dic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s2">&quot;slate&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;protein_</span><span class="si">{</span><span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;cartoon&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;protein_</span><span class="si">{</span><span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;protein_</span><span class="si">{</span><span class="n">hr</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pymol_out</span><span class="o">.</span><span class="n">commands</span> <span class="o">+=</span> <span class="n">PyMOLCommands</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;sticks&quot;</span><span class="p">,</span> <span class="s2">&quot;organic&quot;</span><span class="p">)</span>

        <span class="c1"># find contributing residues</span>

<div class="viewcode-block" id="HotspotWriter.compress"><a class="viewcode-back" href="../../hs_io_api.html#hotspots.hs_io.HotspotWriter.compress">[docs]</a>    <span class="k">def</span> <span class="nf">compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delete_directory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        compresses the output directory created for this :class:`hotspots.HotspotResults` instance, and</span>
<span class="sd">        removes the directory by default. The zipped file can be loaded directly into a new</span>
<span class="sd">        :class:`hotspots.HotspotResults` instance using the</span>
<span class="sd">        :func:`~hotspots.Hotspots.from_zip_dir` function</span>

<span class="sd">        :param bool delete_directory: remove the out directory once it has been zipped</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out_dir</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">container</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s1">&#39;zip&#39;</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delete_directory</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">container</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="HotspotReader"><a class="viewcode-back" href="../../hs_io_api.html#hotspots.hs_io.HotspotReader">[docs]</a><span class="k">class</span> <span class="nc">HotspotReader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to organise the reading of a :class:`hotspots.result.Result`</span>

<span class="sd">    :param str path: path to the result directory (can be .zip directory)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">read_superstar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">read_weighted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">read_buriedness</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_superstar</span> <span class="o">=</span> <span class="n">read_superstar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_weighted</span> <span class="o">=</span> <span class="n">read_weighted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_buriedness</span> <span class="o">=</span> <span class="n">read_buriedness</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_interactions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;apolar&quot;</span><span class="p">,</span> <span class="s2">&quot;donor&quot;</span><span class="p">,</span> <span class="s2">&quot;acceptor&quot;</span><span class="p">,</span> <span class="s2">&quot;positive&quot;</span><span class="p">,</span> <span class="s2">&quot;negative&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_grid_extensions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;grd&quot;</span><span class="p">,</span> <span class="s2">&quot;ccp4&quot;</span><span class="p">,</span> <span class="s2">&quot;acnt&quot;</span><span class="p">,</span> <span class="s2">&quot;dat&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_protein_extensions</span> <span class="o">=</span> <span class="s2">&quot;pdb&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_extension</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_extension</span> <span class="o">==</span> <span class="s2">&quot;.zip&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>

            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">hs_zip</span><span class="p">:</span>
                <span class="n">hs_zip</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_extension</span> <span class="o">==</span> <span class="s2">&quot;.zip&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_generate_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">PushDir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

            <span class="c1"># fetch protein - this should always be protein.pdb</span>
            <span class="n">prot_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protein_extensions</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">prot</span> <span class="o">=</span> <span class="n">Protein</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">prot_name</span><span class="p">)</span>
            <span class="n">files</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">prot_name</span><span class="p">)</span>

            <span class="c1"># there should only be one grid extension in the directory, if there are more</span>
            <span class="c1"># then you can manually read in your results</span>
            <span class="n">grid_extension</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">}</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supported_grid_extensions</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_extension</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Too many grid types, create `hotspots.result.Results` manually&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_extension</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;No supported grid types found&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">list</span><span class="p">(</span><span class="n">grid_extension</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;dat&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Will put this in if requested&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">grid_extension</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">grid_extension</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># read hotspot grids</span>
            <span class="n">stripped_files</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">}</span>
            <span class="n">hotspot_grids</span> <span class="o">=</span> <span class="n">stripped_files</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supported_interactions</span><span class="p">)</span>
            <span class="n">super_grids</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="n">Grid</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">grid_extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hotspot_grids</span><span class="p">}</span>

            <span class="c1"># read superstar grids</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;superstar&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_superstar</span><span class="p">:</span>
                <span class="n">superstar_grids</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="n">Grid</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;superstar_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">grid_extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hotspot_grids</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">superstar_grids</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># read weighted_superstar grids</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;weighted&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_weighted</span><span class="p">:</span>
                <span class="n">weighted_grids</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="n">Grid</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;weighted_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">grid_extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hotspot_grids</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weighted_grids</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># fetch buriedness grid</span>
            <span class="n">buriedness_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;buriedness&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">buriedness_name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_buriedness</span><span class="p">:</span>
                <span class="n">buriedness</span> <span class="o">=</span> <span class="n">Grid</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">buriedness_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">buriedness</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">Results</span><span class="p">(</span><span class="n">super_grids</span><span class="o">=</span><span class="n">super_grids</span><span class="p">,</span>
                       <span class="n">protein</span><span class="o">=</span><span class="n">prot</span><span class="p">,</span>
                       <span class="n">buriedness</span><span class="o">=</span><span class="n">buriedness</span><span class="p">,</span>
                       <span class="n">superstar</span><span class="o">=</span><span class="n">superstar_grids</span><span class="p">,</span>
                       <span class="n">weighted_superstar</span><span class="o">=</span><span class="n">weighted_grids</span><span class="p">)</span>

<div class="viewcode-block" id="HotspotReader.read"><a class="viewcode-back" href="../../hs_io_api.html#hotspots.hs_io.HotspotReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        creates a single or list of :class:`hotspots.result.Result` instance(s)</span>

<span class="sd">        :param str identifier: for directories containing multiple Fragment Hotspot Map results,</span>
<span class="sd">        identifier is the subdirectory for which a :class:`hotspots.result.Result` is requried</span>

<span class="sd">        :return: `hotspots.result.Result` a Fragment Hotspot Map result</span>

<span class="sd">        &gt;&gt;&gt; from hotspots.hs_io import HotspotReader</span>

<span class="sd">        &gt;&gt;&gt; path = &quot;&lt;path_to_results_directory&gt;&quot;</span>
<span class="sd">        &gt;&gt;&gt; with HotspotReader(path) as reader:</span>
<span class="sd">        &gt;&gt;&gt;    reader.read()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># old style single result all files in os.listdir(self.base)</span>
            <span class="n">hr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_result</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># new style single result</span>
            <span class="n">hr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_result</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># more than one hotspot</span>
            <span class="k">if</span> <span class="n">identifier</span><span class="p">:</span>
                <span class="n">hr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_result</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">identifier</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hr</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_result</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">hr</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Chris Radoux, Peter Curran, Mihaela D. Smilova, Richard A. Sykes, Alicia Higueruelo, Anthony Bradley, Brian D. Marsdend, David R. Spring, Tom L. Blundell, Andrew R. Leach, William R. Pitt, Jason C. Cole

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>